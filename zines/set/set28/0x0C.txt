-[ 0x0C ]-------------------------------------------------------------------
-[ Internet desde una empresa local ]---------------------------------------
-[ SET/@RROBA ]-----------------------------------------------------SET-28--

Este es el segundo articulo escrito por SET y publicados por la revista
@RROBA. El articulo fue redactado hace mas de dos anyos y el paso del tiempo se
puede ver claramente desde el punto de vista meramente tecnico, pero no asi
desde la perspectiva humana. Tontos, listillos y aprovechados seguiran
habiendoles mientras el mundo exista. Gente sin grandes ambiciones, pero con
ideas claras, seguiran enfrentandose a los cretinos del apartado anterior.

*****************************************************************************


INTERNET DESDE UNA EMPRESA LOCAL

Los acontecimientos aqui descritos se refieren a personas y situaciones
ficticias, pero son muestra de miriadas de hechos ocurridos y que siguen 
ocurriendo en las redes de habla hispanica (...y estamos seguros que estos 
ejemplos se puede extender al resto del mundo).


1.-INTRODUCCION

En este articulo pondremos algunos ejemplos de lo que pasa y puede pasar en
el establecimiento y explotacion de una pequenya red, de una (todavia mas)
pequenya empresa situada en nuestro autonomico pais.

Hablaremos hoy, de un problema tipico en nuestro entorno y es el desconocimiento
total de los peligros de las nuevas tecnologias, unido a una prepotencia 
apabuyante y a un desenfrenado deseo de beneficios a corto plazo y a cualquier 
precio (pisando a cualquiera).
Nosotros no estamos en contra de los beneficios, que quede claro, pero lo
que deseamos remarcar es que la avaricia suele tener serias consecuencias 
en cualquier entorno, pero con las nuevas tecnologias sus efectos son 
multiplicativos y desvastadores.


2.-HA LLEGADO UN NUEVO CLIENTE

Si se¤ores ! El cliente ha llegado bajo la forma de una comitiva formada por
cuatro personas. El gerente en persona (recordad que se esta hablando de una
peque¤a empresa de unas veinte personas) les acoje afablemente, los introduce
en la mejor sala de reuniones disponible y ordena la distribucion de los
socorridos cafes, cortados y demas bebidas con cafeina al gusto (de cada uno).

El ejemplar gerente es una persona por demas simpatica y agradable. De palabra
facil, inmediatamente distribuye a su personal en torno a la mesa, procurando
en lo posible separar a los visitantes. Los componentes de su sequito, lucen en
sus impecables tarjetas, generosos titulos (Director de Tal, Director de Cual)
con el unico fin de mostrar la potencia de semejante empresa.
Todo son sonrisas y entre comentarios banales pasan unos minutos. Aparentemente
el ambiente es distendido y todo hace pensar en el comienzo de unas relaciones 
win-to-win (como esta de moda decir ahora), en las cuales tanto proveedor como 
cliente van a hacer estupendos negocios y obtener pingues beneficios en un 
ambiente de estrecha relacion, abierta comunicacion y franca confianza mutua.

Sin embargo, con nuestros poderes de hackers (..o tal vez le hemos leido el 
correo, evidentemente sin cifrar ?, o a lo mejor nos hemos ligado a su 
secretaria?,..que mas da!) nos hemos introducido en la mente del gerente y 
hemos leido su pensamiento (solo tiene uno) :

'A esos pardillos, los desplumo'

Entre los clientes, actua como lider un personajillo mas bien gris, callado,
un poco introvertido y poco hablador.

Asustados, pasamos al cerebro del lider del grupo de los clientes, con el animo
de intentar pasarle un mensaje de alerta y advertirle. Sin embargo, ante 
nuestra sorpresa, nos encontramos ante un cerebro bien organizado que analiza y
rastrea los mas minimos detalles y con una alarma activada desde hace rato  
diciendo con letras de colores :

'De este bocazas, no me fio ni un pelo'

Como pasa a menudo, las apariencias enganyan.


3.-OFRECIMIENTO

Con gran aparato y parafernalia de transparencias y proyecciones, nuestro
gerente expone los datos principales de su empresa :

- Somos una pequenya companyia con gran agresividad.
- Tenemos la ultima tecnologia.
- Nuestras conexiones de alta velocidad.
- Disponemos de personal cualificado y motivado.
- ....otras mentiras varias y diversas.

Despues un poco de jabon para los presuntos primos que van a ser desplumados
(o sea los clientes) :

- Como serios representantes de su companyia....
- ...que desea hacer un 'outsourcing' de las tareas que no representan el 'core
  busines' de sus negocios..
- ...y nos han elegido para proponernos que les hagamos el trabajo tedioso
  de llevar la contabilidad y la gestion de stocks.

Y finalmente su propuesta :

- Gestion de la contabilidad con envio de informacion diaria.
- Gestion de stocks en tiempo real.
- Conexion en tiempo real entre sus 'host' y los de sus cliente.

Todo ello acompanyado con :

- Bases de datos relacionales de maxima seguridad.
- Certificados de calidad ISO-no-se-cuantos-mil.
- Programas de aseguramiento de la calidad.
- ....

Y sobretodo no hay que olvidar el dato economico,.. y ahi nuestro gerente lanza
su cebo 'dado que todo ello representa un esfuerzo para nuestra organizacion 
y una redistribucion de tareas para conseguir que las relaciones entre nosotros
y Uds se realicen por canales priviligiados, les pedimos que en nuestro contrato
de servicios, se adelante un 20% de la facturacion anual'


4.-SOSPECHA Y BUSQUEDA DE LA VERDAD

El, gris, jefe de los clientes, no se inmuta ni ensenya sus cartas. Recoge las
informacion, reune a su aturdido grupo, y retorna a su empresa. Ahi mismo
inicia la fase de investigacion 'legal', no supone ningun problema frente a la
ley dado que lo desea hacer es consultar las bases de datos de registro de 
nombres de Internet y estas son libres y publicamente consultables.

En su empresa tampoco son ninguna maravilla de la informatica y solo dispone
de terminales Win-95, y este sistema operativo es un poco anemico y no dispone
de las utilidades basicas para hacer este tipo de consultas, pero siempre
podemos encontrar soluciones si se buscan con empenyo.

Unas cuantas vueltas por internet le muestran las herramientas necesarias
para sus objetivos :

- http://www.pc-help.org/trace.htm, si quiere una herramienta DOS tipo terminal.
- http://samspade.org/ssw/, si quiere bajarse una herramienta 'bonita'
- http://www.internic.org/whois.html, si consulta con un navegador.

De ahi extrae las primeras informaciones y saca las primeras concluciones.

- El proveedor de acceso de internet es de segunda categoria, y esto no cuadra
  mucho con las infulas de 'tecnologia punta'.
- Aparece como persona de contacto,....el propio gerente !, y esto tampoco
  cuadra con las historias de que 'esta empresa es como una gran familia'.
- Aparece un unico server y ninguno alternativo, y esto significa poca 
  fiabilidad y escasas ganas de gastarse dinero.
 
A partir de ahi lo que desea realizar no es totalmente legal y por tanto
decide hacerlo desde un terminal que no tenga relacion alguna con su empresa.
Tampoco es una accion de alta tecnologia hacker, pero un scaneo de puertos
es ilegal en algunos paises y considerado como minimo poco educado si se
realiza sin permiso y desde luego si se hace sin precuaciones es totalmente
detectable.

No vamos a explicar en este articulo como ni donde realizo su callada labor
pero lo importante es que consiguio rapidamente la siguiente informacion en
uno de las maquinas que alojaban los servidores :

- Un servidor FTP corriendo un software con un conocido bug.
- Un servidor FINGER esperando a que alguien le pidiera alguna informacion
  (esto ya era para nota, hoy en dia no hay ninguna maquina que suministre este
  tipo de servicio, debido a la peligrosidad de la informacion que proporciona).

Ni siquiera necesito explotar el bug del FTP, dio la casualidad que alguien
con privilegios de root estaba conectado, con el servicio FINGER obtuvo una muy
interesante informacion (e-mail completo, numero de telefono, departamento donde
trabajaba). Debido a que probablemente jamas habia leido nada sobre seguridad y
las minimas precuaciones al establecer una password, esta era tan facil de 
adivinar como su mentalidad.

Resumiendo que a las dos horas de trabajar, y despues de hacer un par de 
conexiones, unos pocos escaneos de red extras, era ya poseedor de la informacion
necesaria para conocer la estructura de la red que teoricamente debia ser 
capaz de dar servicio a su companyia con gran fiabilidad y seguridad, bendecida
con toda suerte de certificaciones.



5.-QUE HABIA DEBAJO DE TODO


La red que nuestro egregio gerente ofrecia pomposamente, no era nada mas que 
una chapuza de las que tanto abundan en nuestros lares. En el esquema adjunto
podeis ver la calamidad del invento.



ord1    ord3    ord5    ord7    ord9          ord19    
  |      |       |       |       |             |
  £------£-------£---£---£-------£--- ...  ----£
                     | 
                  hub 10 --- router ---- internet -------------------  
                                                    
                     |
  £------£-------£---£---£-------£---- ...  ---£
  |      |       |       |       |             |
ord2    ord4    ord6    ord8    ord10         ord20


Ningun firewall, protegiendo los datos internos, un miserable hub a 10 Mb/s,
y si nos hubiesemos molestado en investigar un poco mas, hubieramos descubierto
tarjetas de red, tambien a 10 Mb/s y lamentable cableado, instalado con
material sin especificaciones y por personal de dudosa cualificacion.

Resumiendo, una red que debia tener frecuentes fallos, paros y bloqueos, 
dificil de asegurar su seguridad y de todavia mas dificil ampliacion. Casi
con seguridad, el cableado no respetaba las especificaciones para la velocidad 
de 100 Mb/s y evidentemente el hub ni siquiera estaba previsto para ello y de 
todas formas estaba al limite de su capacidad.

No estamos hablando de ninguna configuracion excepcional, es casi la norma
actualmente cuando hablamos de una veintena de terminales y todavia podemos
encontrar configuraciones mas debiles y gente que tranquilamente guarda su
correo electronico en cualquiera de dichas maquinas. Todavia es mas interesante
comprobar, que la misma persona que realiza estos actos insensatos, cierra 
cuidadosamente con llave la puerta cuando abandona su negocio cada dia, 
contrata servicios de seguridad externos y establece procedimientos para evitar
que sus empleados se lleven a casa los boligrafos y las gomas de borrar.

Este tipo de actitudes seran siempre un misterio para nosotros y solo podemos
pensar que son causa de un trauma infantil o de un gusto desenfrenado por las
cerraduras.



6.-DESENLACE

El principal problema, lo tuvo nuestro jefe de delegacion en explicar a sus 
superiores el origen de su informacion, por dos motivos, uno era que tampoco es
cuestion de ir explicando por el mundo que te has divertido a asaltar las 
maquinas de uno de los proveedores de Internet de este pais, otro, y no menos 
importante, era que la eleccion de la empresa suministradora estaba guiada y 
teledirigida desde las alturas de su empresa.

Es curioso, de todas formas, que fue aceptada de forma normal la version que 
dio nuestro heroe para explicar la fuente de informacion. Dijo que tenia un
amigo que habia trabajado en la instalacion del desastre de red y que sabia de
buena tinta que no habia sido modificada desde sus inicios.

Sumamente demostrativo de nuestra hipocresia. Nadie hace aspavimientos si el
tipo de espionaje es el clasico 'boca a oreja', sin embargo todo el mundo mira 
por encima del hombro y pone adjetivos raros ('Este es un hacker') si la misma
informacion se obtiene por medios, en nuestra humilde opinion, mucho mas 
elegantes.

El gerente del inicio de la historia, recibio una carta formal desestimando sus
servicios y un golpe de telefono de su amigo en las cumbres, diciendole la
verdad del porque no se firmaba el contrato y acusandole de irresponsable por
tener una red en semejante estado. Ni uno ni otro fueron tampoco muy capaces de
enterarse del contenido tecnico del problema pero no fue ningun obstaculo para
desencadenar la tipica reaccion del gerente, una buena bronca al responsable 
informatico (que ya le habia avisado repetidamente de la debilidad de la red).

La bronca fue en privado, para que nadie se enterase, ya que el propio gerente
salia salpicado en la historia, pero el responsable informatico, aprendio la 
leccion y se dio cuenta que de semejante individuo no podia fiarse ni podria 
obtener apoyo en caso de problemas. Inicio rapidamente gestiones para encontrar 
un nuevo trabajo y paralelamente implanto una serie de medidas en la red actual
que le permitieran acceder y recoger informacion en caso de despido fulminante.

LLegado a este punto, podemos sacar dos ensenyanzas generales a esta historia:

1.-Parte de la culpa de escenarios parecidos a este, recaen sobre el mismo 
   tecnico que no es capaz de decir NO. El contrato para la instalacion de una 
   red informatica no es igual a la adquisicion de una canya de cerveza en un 
   bar (pagas 300 ESP y te la ponen en dos minutos). Una buena red requiere 
   unas pocas horas para instalarla, pero despues requiere semanas para 
   comprobaciones, certificaciones, derechos, etc... y un tecnico que se precie
   debe ser capaz de explicar todo esto.

2.-Aqui tambien hay que llamar la atencion a la alegria con que se contratan y
   despiden tecnicos de redes y las consecuencias que ello puede llegar a tener
   si no se toman precauciones legales, pero esto puede ser objeto de otro 
   articulo.



***********************************************************************
*********TECNICAS PARA LOGRAR INFORMACION PUBLICA**********************
***********************************************************************

 La informacion publica que se encuentra en Internet, estaba hasta 1999 
centralizada en la empresa Network Solutions, que tenia el monopolio del
registro de nombre, pero esto ha terminado y actualmente el listado completo
de operadores calificados para efectuar registros de nombres en Internet lo
podeis encontrar en http://www.internic.net/alpha.html

 Una vez en cualquiera de los enlaces que encontrareis en internic.net, os
dara la opcion de buscar informacion sobre nombres ya registrados. Esta es la
informacion que puede resultar mas interesante para alguien que quiera empezar
a conocer al objetivo.

 Tambien se pueden encontrar via web a traves de las direcciones siguientes :

- www.networksolutions.com
- www.arin.net

 Para los muy vagos que ni siquiera quieran tener el trabajo de analisis, 
existen herramientas normalizadas para efectuar este tipo de tareas :

- www.samspade.org   Buen cliente windows, que hace esto y mas.
- www.oxygene.500mhz.net Si trabajais desde unix.

 Pero en todo debe de haber un metodo, aqui no encontrareis excepciones, una
vez encontrada la informacion debemos conocer para que sirve cada cosa. Los
datos que presentan cualquier registrador de dominios se pueden dividir en
dos partes principales :

- Datos de organizacion de la empresa
- Datos del dominio.

 En los datos de la empresa podemos encontrar los datos de la persona de 
contacto con su direccion de correo electronico, su numero de telefono y
su direccion postal.

 En los datos del dominio encontraremos la direccion fisica de la maquina que
aloja el dominio, sus backups y la clase de red que tiene registrada.

 Finalmente, si la empresa en la cual estamos interesados es muy grande, 
siempre es util buscar los dominios que tienen un nombre parecido. En muchos 
casos, las empresas de gran tamanyo tienen registrados varios dominios por 
razones administrativas o de registro industrial.


***********************************************************************
*********TECNICAS DE SCANEO DE PUERTOS*********************************
***********************************************************************

 La comparacion clasica del scaneo de puertos, es con los edificios. Con
la busqueda de dominios hemos detectado donde se encuentran los edificios, 
ahora nos toca ver que puertas existen, con que tipo de cerraduras estan 
aseguradas, si son faciles o no de abrir (a lo mejor estan ya abiertas, 
esperandonos),...

 El primer paso es la deteccion de que maquinas estan vivas y cuales no, esto
es lo que abitualmente se llama el 'ping sweet'. La tecnica es conocida y se
utilizaba normalmente para tareas administrativas y consta en el envio de un
paquete ICMP ECHO (tipo 8) a la maquina objetivo y esperar el ICMP ECHO_REPLY
(tipo 0). Si se recibe es senyal univoca de que la maquina es operativa.

 Si se scanea una red muy grande el procedimiento puede durar dias. En la red
se encuentran cientos de utilidades para hacer estas tareas, pero entre todas
podemos destacar :

 - Pinger en www.nmrc.org/files/snt/ para Windows adictos
 - icmpenum en www.nmrc.org(files/sunix/icmpenum-1.1.tgz para partidarios de 
   unix y sus sabores


 Una vez identificada las maquinas vivas, pasaremos a escanear los puertos que 
se encuentran abiertos o simplemente existentes, identificando sus niveles de 
seguridad. Para poner un ejemplo grafico/numerico :

 21  ftp-data
 23  telnet
 79  finger (...de esos ya no hay!)
 80  http

... y un largo etcetera.

Existen diversas tecnicas de scaneo y lo que es mas importante, unas son mas
ruidosa que otras, pasando desde las practicamente indetectables a las que 
hacen saltar todas las senyales de alarma.

- TCP connect scan. Es el scaneo clasico, con los tres 'apretones-de-mano' que
  configuran una conexion. (SYN, SYN/ACK, ACK)
- TCP SYN scan. Se denomina 'media conexion' ya que no se establece el dialogo
  de forma copleta. Si se recibe un SYN/ACK se deduce que el puerto esta 
  abierto, si se recibe un RST/ACK se deduce que el puerto esta cerrado. En 
  todocaso se contesta con un RST/ACK de forma que la maquina escaneada no
  registra en sus logs la conexion y pasamos desapercibidos.
- TCP FIN scan. Se envia unn paquete FIN. si se recibe un RST significa que el
  puerto esta cerrado. Normalmente, solo funciona en maquinas UNIX.
- TCP Xmas Tree. Esta tecnica envia un FIN, URG y PUSH. Deberia responderse
  RST para todos los puertos cerrados.
- TCP Null scan. Pone en off todos los flags. Misma respuesta que en el caso
  anterior.
- TCP ACK scan. Tecnica empleada para scanear a traves de un firewall. Es 
  util para determinar si el firewall hace solo un filtrado de puertos o bien
  tiene etablecidas reglas complejas.
- TCP Windows scan. Util para detectar estadode puertos en algunas sistemas
  debido a las anomalias en el tratamiento de los paquetes TCP (AIX, FreeBSD)
- TCP RPC scan. Tecnica especifica para UNIX
- UDP scan. S envia un paquete UDP, si la respuesta es 'ICMP port unreachable'
  el puerto esta cerrado, en caso contrario se deduce que el puerto esta 
  abierto. No es una tecnica de gran fiabilidad y ademas es muy lenta de
  ejecucion.


Podemos encontrar en la red multiples utilidades que permiten efectuer un 
scaneo de puertos, pero creemos que lo mas importante es conocer las 
posibilidades y por supuesto las consecuencias (para el scaneado y para 
nosotros).

Aconsejamos el nmap, que podemos encontrar en www.insecure.org, y sobretodo 
leer la documentacion que se encuentra en su web..... bueno, este es un
consejo generico mas facil de hacer que de seguir, pero no aconsejamos hacer
scaneos de puertos alegremente, ya que segun que tipo de redes, pueden tener
respuestas contundentes.

*EOF*