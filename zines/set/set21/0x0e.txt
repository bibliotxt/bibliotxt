-[ 0x0E ]-------------------------------------------------------------------- 
-[ EL ULTIMO PAQUETE ]------------------------------------------------------- 
-[ by Paseante ]------------------------------------------------------SET-21- 
 



Hace mucho tiempo en una galaxia muy lejana...



INTRODUCCION

Bienvenido a este viaje. Es un viaje en el que vamos a descubrir y explorar
un nuevo sistema, al menos para mi, veremos en primera fila como se efectua
un hackeo y de paso le daremos en los morros a Timofonica.
Si esto no te ha convencido de leer lo que sigue no se que lo hara ;-DD

Este articulo se debe en parte a dos personas, a FCA00000 que al contar sus
faza~as en SET 20 ha reavivado el interes de nuestros lectores por el 
'lado oscuro' y a Madfran, que si bien jamas me ha animado ni sugerido
hacer nada ilegal, apunto una vulnerabilidad del servidor web de 
Telefonica -http://www.telefonica.es- en la lista del staff del SET.

Y claro, aqui teneis a vuestro humilde servidor (que no asume la autoria
de nada y que escribe en primera persona solo porque queda mejor) que
aun estando inmerso en otras historias completamente ajenas y semi-
retirado del ajetreo que conlleva este mundillo no puede evitar
darse una vuelta por las fauces del monstruo Timofonico y ver como esta
la cosa....asi empieza nuestra historia.
 



- PARTE I-. DANDO FORMA A SU PAQUETE

Fue recibir el mensaje de Madfran y darme una vuelta por www.telefonica.es,
en efecto habia un serio problema de configuracion que me permitio bajarme
el fuente de varios CGI entre otras cosas...estuve mirandolo un poco ya
desconectado y pense. Por que no mirar un poco mas toda la red de Timofonica?

Dicho y hecho, usando una cuenta cualquiera y con varios trucos que ya se
han explicado en SET vuelvo a la carga dispuesto a hacer un ping-scan con
nmap sobre un grupo de clases C como:

194.xxx.?5.*
194.xxx.?2.*
194.xxx.?2.*
entre otras 

Por cierto, acostumbrate a que a partir de ahora altere datos, oculte
direcciones IP y suprima y modifique output de las maquinas afectadas.
Y como siempre comentarios intercalados en el output de comandos en
las lineas que empiecen por $$.

Lo que no recomiendo es pillarle la cuenta a uno que te caiga mal en el IRC
y usarla, luego cuando la pasma vaya a por el y le pillen la guia del
superhacker seguro que no se libra ni de casualidad. :-X

Como la mayor parte de esas maquinas estan tras algun tipo de bloqueo o
son Windozes, algunos de los 'stealth scan' no sirven de nada, tras mirar un
poco aqui y otro alla y por gentileza de la srta. Rocio S. me guipo una
serie de logins/passwords que no me sirven de nada y una lista de equipos
accesibles en la red interna (Direcciones IP privadas del rango 192.168.)

Y mira por donde examinando el monton de logs que he acumulado encuentro 
algo que me llama la atencion.....hora de que comience el juego.
En mi desconocimiento e ignorancia me dirijo felizmente a una web en 
alguna IP perdida que pone algo como "PacketShaper" y una caja de entrada 
para meter una clave. Como tonto del todo no soy, colijo que se trata de
algun sistema para distribuir el ancho de banda. 
Claves a mi!. Acierto a la primera. (Natural). Y me encuentro con una
cosa muy chula con frames, formularios, Javascrises de esos. Muy bonito,
pero es tiempo de entrar por telnet (tambien se puede) porque asi puedo
hacer un log :-)):


pas@solsticio:~> telnet 194.*.xxx.* | tee timo-log5

Trying 194.*.xxx.*...
Connected to 194.*.xxx.*.
Escape character is '^]'.


PacketShaper (194.*.xxx.*)

Password: 
PacketShaper v4.0.4g1 1999-08-11
Copyright (c) 1996-1999 Packeteer, Inc. All rights reserved.
Packet shaping: off.

$$ Perfecto, ya estoy dentro. Pero dentro de que?. Mi truco de siempre ;-)

PacketShaper> help

PacketShaper commands are divided into five groups:

  shaper          Group of commands to configure and view the traffic-
                  shaping facilities of the PacketShaper--class, policy,
                  partition, hostdb, traffic, links, measure, hl, event

  setup           Command to configure and view the basic settings of the
                  PacketShaper

  group           Command to manage the Group Configuration Service (GCS)

  diagnostic      Group of diagnostic commands--arp, dns, mib, ping, net,
                  sys, and uptime

  utility         Group of file manipulation commands

  miscellaneous   Group of miscellaneous commands--look, touch, exit, help,
                  reset, run, version, schedule, group, image

For more information on a group of commands, type "help <group>".  For
more information on a specific command, type "help <cmd> ...".

PacketShaper> help shaper

The following are the traffic shaping-related commands:

class           Configure and view traffic classification
email           Manage Email
event           Manage User Events
hostdb          View host database information
partition       Create, modify, and view partition information
policy          Apply, remove, or modify policies
traffic         Display traffic class usage information
links           Display link statistics
measure         Configure and retrieve data from measurement engine
rtm             Display or configure Response Time Measurement

PacketShaper> help links

To display access link statistics, use the following command:
links <arg> ...

where <arg> is one of the following:
show            Display link statistics

PacketShaper> links show

Interface     Speed    Cur    1 Min    Peak 
                       rate     avg    rate 
--------------------------------------------
Outside    50000000     5.5M    5.2M   22.3M
 Inside    50000000    10.2M    9.6M   26.7M



$$ Esto nos interesa, lo que dice es que este PacketShaper esta instalado
$$ en un lugar en el que hay dos conexiones de 50MB cada una para trafico
$$ interior y exterior. Luego os explicare en mas detalle :->.

PacketShaper> help miscellaneous

The following are the miscellaneous commands:

look            Resume look-level access (view-only)
touch           Acquire touch-level access (view or modify)
exit            Logout
help            On-line help facility
image           Image commands
run             Execute a script file
schedule        Schedule commands
version         Display PacketShaper software version & serial number


$$ De aqui destacar los comandos look y touch, el PacketShaper funciona
$$ como los Cisco, con la password de entrada estas en modo look (solo mirar)
$$ con una segunda password para touch puedes modificar la configuracion y
$$ obtener el control total (al estilo enable en Cisco)

PacketShaper> touch

Password: 

Touch access denied

$$ Casi!

PacketShaper> help image

The following are the image commands:

list            List contents of the current PacketShaper image
show            Show image version(s)

PacketShaper> image show

Active Image version: PacketShaper v4.0.4g1 1999-08-11
Backup Image version: PacketShaper v4.0.3g3 1999-07-01
Bootloader version  : Bootloader v3.00g1 1997-09-22  

PacketShaper> image list

      3256 06/04/1999 10:52:44 about.htm
      7798 03/12/1999 17:35:28 art.htm
      6703 03/15/1999 08:59:36 artgmore.htm
      7093 03/15/1999 08:59:34 artgraf.htm
      9408 06/04/1999 10:53:46 artview.htm
      3617 03/08/1999 18:18:20 artwclt.htm
      269 06/25/1998 13:41:32 images/menu0.gif
      256 06/25/1998 13:41:32 images/menu1.gif
       221 03/11/1999 17:11:40 images/menu10.gif
      2039 12/03/1998 18:06:58 libform.js
      9794 10/20/1998 14:58:38 libmd5.js
      2441 10/23/1998 13:01:16 libmenu.js
     14233 07/21/1999 10:47:54 libpctl.js
     1913 12/28/1998 13:03:26 polbuck.htm
      6198 05/03/1999 11:41:06 polerr.htm
      5645 11/25/1998 15:44:54 polfovr.htm
      1872 03/01/1999 16:02:52 policy.htm
      4808 12/29/1998 18:46:44 polipqos.htm
      2821 11/25/1998 15:44:54 polprec.htm
     11979 07/12/1999 14:04:44 polscal.htm
     10823 01/28/1999 15:45:16 GraphT/GraphTop.gif
      8126 01/28/1999 15:45:16 GraphT/GraphTop.gif
      1368 07/21/1999 13:12:06 pshelp/tspecrit.htm
      2795 03/15/1999 10:20:16 pshelp/ttoshlp.htm
     36422 07/21/1999 10:23:20 rptbld.htm
      5852 07/21/1999 10:37:02 rptevt.htm
      9308 07/21/1999 11:51:38 rptmain.htm
     12348 05/03/1999 11:10:34 rpttop.htm
      3936 02/08/1999 12:27:46 tophdlog.htm
      1173 01/26/1999 16:54:48 toplstrs.htm
      1175 01/26/1999 16:54:46 toptalks.htm
      3181 03/26/1999 17:26:02 tspecd.htm
      4786 06/28/1999 17:23:52 tspectos.htm
   2053840 08/11/1999 16:34:04 ram.abs

$$ He editado mucho este listado, mostraba toda la estructura de la web
$$ pero salen un porron de ficheros y se me hacia pesado. Dejo unos
$$ pocos para que os hagais una idea.

PacketShaper> pepe


  arp               ARP commands
  class             Classifier commands
  dns               DNS commands
  ds                Directory configuration commands
  group             Group configuration commands
  help              On-Line help facility
  hl                Host list configuration commands
  hostdb            Host database commands
  image             Image commands
  ipfilter          IP filter commands
  links             Link commands
  look              Withdraw touch access (go back to look-only access)
  measure           Measurement commands
  mib               MIB commands
  net               Network statistics commands
  partition         Bandwidth partition commands
  policy            Policy commands
  rtm               Display or modify Response Time Measurement information
  schedule          Schedule jobs
  setup             Setup network addresses and access control
  sys               System level commands (mon, event, buf, tim)
  touch             Grant touch access
  traffic           Display traffic class/usage information
  uptime            Display system uptime
  version           Display software version

$$ Mira que chulo XDDD

PacketShaper> help ds

usage: ds <arg> ...

where <arg> is one of the following:

cd              Browse to directory entry
dump            Dump current directory entry's contents
local           Store configuration locally (no directory synch)
ls              List children of the browser's current entry
pwd             Show browser's current directory entry DN
sessions        Show LDAP session status


PacketShaper> ds dump

iqosConfigurationAgent           194.*.xxx.*, 19990705083013Z
iqosConfigurationConsumer        194.*.xxx.*, 19990331140831Z
iqosGlobalHostListsDn            ou=hostlists,ou=_global,ou=pscfg,o=tsai.es
iqosGlobalRootDn                 ou=_global,ou=pscfg,o=tsai.es
iqosIpAddress                    194.*.xxx.*
iqosLocalHostListsDn             ou=hostlists,ou=194.*.xxx.*,ou=pscfg,o=tsai.es
objectClass                      iqosConfigurationRoot
objectClass                      top

$$ Estos de TSAI, (Telefonica Servicios Avanzados de Informacion) no son de
$$ aqui los dos tipos que presionaron para chaparnos por segunda vez la
$$ web?. Creo que GreeN LegenD sabia del tema.

PacketShaper> net


  nic               Read chip status
  ip                Show IP info
  pna               Show network status

PacketShaper> net ip

MyIpAddr 194.*.xxx.*  mask ffffffc? 

Site Router 194.xxx.*.xx

Inside:  00:80:bb:2f:c3:e2 hardware = 00:80:bb:2f:c3:e2
Outside: 00:80:bb:2f:c3:e2 hardware = 00:80:bb:2f:c3:e3

Ignore relay rate: in 3738749  out 8370837

local MIB:
[ 0] RcvdPkts                  91638 [ 1] RcvdPktsFiltered          15800 
[ 2] TxPkts                    34127 [ 3] TxUnrouteable                 0 
[ 4] TxBcasts                      0 


$$ Y un monton de rollo mas que me salto, la configuracion basica del
$$ PacketShaper incluye darle una direccion IP, decirle cual es el router
$$ que sale a Internet, el gateway, un servidor DNS...claro que todo eso
$$ lo aprendi al bajarme los manuales y para ello tuve que hacer un 'invento'.


PacketShaper> uptime
System up for 2 days 19 hours 33 mins 1 secs

PacketShaper> version

Version: PacketShaper v4.0.4g1 1999-08-11
Product: PacketShaper 4000
Serial Number: 100-10003xxx
Memory: 128MB RAM, 7.6MB Flash total, 3.0MB Flash available
Copyright (c) 1996-1999 Packeteer, Inc. All rights reserved.

$$ El numero de serie lo mutilo, luego tuvo su historia. :-)

PacketShaper> sys


  info              Display System Information
  buf               Buffer commands
  dio               Digital I/O commands
  diag              Run diagnostic commands
  event             Event manager commands
  kmemory           Kernel memory commands
  limits            Show configuration limits
  lcd               LCD test commands
  mon               Monitor commands
  nic               Diagnostic NIC commands
  set               Variable setting commands
  tim               Timer commands
  utc               Coordinated Universal Time commands

PacketShaper> sys info
CPU Brand:  AuthenticAMD
CPU Speed:  369 MHz (measured)
Memory:     128 MB
BIOS info:  99/01/21 V1.09  (C) 1997 Gateworks Development

$$ En esta primera sesion estoy intentando obtener el maximo de info
$$ posible del sistema, asi cuando desconecte tendre bastante que estudiar
$$ Sigamos viendo la configuracion.

PacketShaper> sys limits

Statically allocated objects          Current  Remaining      Total
-------------------------------------------------------------------
Traffic classes                           138        374        512
Partitions                                  9        247        256
Policies                                    2        510        512
Matching rules                            232        408        640
Classes with traffic discovery              0         32         32
Classes with RTM                            0         16         16
Classes with top talkers/listeners          0         12         12
TCP flows                               48614       2586      51200
Other IP flows                          25600          0      25600


$$ Si no sabes que es esto tranquilo, yo tampoco lo sabia y me entere
$$ mas tarde.
$$ Fijate en el numero de conexiones que muestra, no hace falta ser
$$ muy espabilado para darse cuenta de que no estamos en Calzados Perez.


Dynamically allocated objects         Current  Potential      Total
-------------------------------------------------------------------
Matching rule host references             117       1183       1300
Host list entries                           5       5611       5616
DNS names                                 113       5929       6042

Note: "Potential" for each object is an estimate allocating all
remaining dynamic memory to that object type.


PacketShaper> sys verify

That command [verify] requires touch access.


$$ Otra vez el touch pero no voy a insistir porque como desconozco el
$$ sistema solo falta que la pifie.

PacketShaper> sys set

System values                   Current   Default   Min       Max 
=========================================================================
artGapInclusion                 0         0         0         1         
assertDisable                   1         0         0         9999999   
bridgeBcastAT                   1         1         0         1         
bridgeBcastDEC                  1         1         0         1         
bridgeBcastFNA                  1         1         0         1         
configPeriod                    60        60        0         86400     
connResourcePpt                 1024      1024      10        1024      
dgFlowIdleTime                  60        60        10        3600      
diagInterval                    9000000   9000000   0         86400000  
loSpeedThresh                   56000     56000     300       9999999   
mailQueueMax                    32        32        32        128           
touchRecoveryTime               30        30        0         3600      
userEventMaxDefinitions         32        32        32        128       
userEventMaxRegistrations       32        32        32        128       
writeProtectFiles               1         1         0         1         


$$ Otro listado enorme pasa por mi pantalla, menos mal que va a un log!
$$ Recorto el 90% y lo pongo aqui para que veas un poco, yo no me lo mire
$$ demasiado.


PacketShaper> sys mon


  idle              Display CPU idle time
  cmos              Display CMOS settings
  struct            Display structure sizes

PacketShaper> sys mon cmos
Date & Time:  21:58:28, 1999-xx-xx
Base Memory:  576 Kbytes (configured)
Extd Memory:  576 Kbytes (configured)
Extd Memory:  576 Kbytes (detected by POST)
Hard Disk C:  1
Hard Disk D:  3
CMOS Status:  Battery=OK, Config=OK, Memory=OK, Disk=OK, Time=OK
CMOS ChkSum:  0da4 (Correct)

$$ No pensaras que iba a dejar el dia y la hora tal cual. :-)


PacketShaper> sys nic info

device INSIDE   00:80:bb:2f:c3:e2
Link State: UP (speed = 100000000) Controller Type: PCnet-FAST 79C971
nic0 MIB:
[ 0] TxOctets              3236795492 [ 1] RxOctets              3476696884 
[ 2] TxUnicast             243266809 [ 3] RxUnicast             276920847 
[ 4] TxNonUnicast               4061 [ 5] RxNonUnicast             134168 
[ 6] TxQueued                      2 [ 7] rxQueued              277057183 
[ 8] TxTimeouts                    0 [ 9] RxDrops                       0 
[10] TxErrors                      2 [11] RxRunts                       0 
[12] TxBabbleErrors                0 [13] RxErrors                      0 
[14] TxBufferErrors                0 [15] RxOverflowErrors              0 
[16] TxRetryErrors                 0 [17] RxFramingErrors               0 
[18] TxUnderflowErrors             0 [19] RxCrcErrors                   0 
[20] TxLateCollisions              0 [21] RxFifoErrors                  0 
[22] TxNoLinkErrors                2 [23] RxMissedErrors                0 
[24] TxRingFullErrors              0 [25] RxLateDrops                   3 
[26] TxInterrupts                  0 [27] RxInterrupts                  0 
[28] NumRestarts                   0 [29] NumInterrupts                 0 
[30] IsrReenters                   0 [31] LinkChangeTime                5 
[32] DrdQuad0                     85 [33] DrdQuad1                      0 
[34] DrdQuad2                     17 [35] DrdQuad3                      0 
[36] DrdBrickWallHits              0 

NIC 0 PHY Control (reg0=2100, reg17=ffffc001).
mode:   manual
duplex: FULL
speed:  100

NIC 0 PHY Status (reg1=780d)
Auto-negotiation supported:  YES (incomplete)
100bt Full duplex supported: yes
100bt Half duplex supported: yes
10bt  Full duplex supported: yes
10bt  Half duplex supported: yes

NIC 0 PHY Ability (reg4=1e1)
100bt Full duplex supported: yes
100bt Half duplex supported: yes
10bt  Full duplex supported: yes
10bt  Half duplex supported: yes

device OUTSIDE   00:80:bb:2f:c3:e3
Link State: UP (speed = 100000000) Controller Type: PCnet-FAST 79C971
nic1 MIB:
[ 0] TxOctets              1873185020 [ 1] RxOctets              781601823 
[ 2] TxUnicast             276876370 [ 3] RxUnicast             243611937 
[ 4] TxNonUnicast             136227 [ 5] RxNonUnicast               1998 
[ 6] TxQueued                      0 [ 7] rxQueued              243614077 
[ 8] TxTimeouts                    0 [ 9] RxDrops                       0 
[10] TxErrors                      2 [11] RxRunts                       0 
[12] TxBabbleErrors                0 [13] RxErrors                      0 
[14] TxBufferErrors                0 [15] RxOverflowErrors              0 
[16] TxRetryErrors                 0 [17] RxFramingErrors               0 
[18] TxUnderflowErrors             0 [19] RxCrcErrors                   0 
[20] TxLateCollisions              0 [21] RxFifoErrors                  0 
[22] TxNoLinkErrors                2 [23] RxMissedErrors                0 
[24] TxRingFullErrors              0 [25] RxLateDrops                  16 
[26] TxInterrupts                  0 [27] RxInterrupts                  0 
[28] NumRestarts                   0 [29] NumInterrupts                 0 
[30] IsrReenters                   0 [31] LinkChangeTime                5 
[32] DrdQuad0                    238 [33] DrdQuad1                     84 
[34] DrdQuad2                     72 [35] DrdQuad3                     71 
[36] DrdBrickWallHits              0 

NIC 1 PHY Control (reg0=2100, reg17=ffffc001).
mode:   manual
duplex: FULL
speed:  100

NIC 1 PHY Status (reg1=780d)
Auto-negotiation supported:  YES (incomplete)
100bt Full duplex supported: yes
100bt Half duplex supported: yes
10bt  Full duplex supported: yes
10bt  Half duplex supported: yes

NIC 1 PHY Ability (reg4=1e1)
100bt Full duplex supported: yes
100bt Half duplex supported: yes
10bt  Full duplex supported: yes
10bt  Half duplex supported: yes


$$ Mas info, esta vez sobre las tarjetas, nos viene a decir que soportan
$$ 100 MB/S y como esta yendo el trafico que pasa por ellas.
$$ La tarjeta INSIDE se conecta al hub de la LAN y la OUTSIDE al router
$$ que sale a INTERNET.

PacketShaper> policy


  show              Show details of a specified policy

PacketShaper> policy show

usage: show <tclass> [clear]

$$ tclass?. No lo tengo claro, ya lo mirare mas tarde.


PacketShaper> help setup

To configure and view the PacketShaper basic settings, use the following
command:

usage: setup <arg> ...

Where <arg> is one of the following:

failover        Set/show failover configuration
nic             Set interface speed and duplex
show            View basic configuration

PacketShaper> setup show

IP address:             194.*.xxx.* Subnet mask: 255.255.255.1xx
Inside nic speed:       100BT full-duplex
Outside nic speed:      100BT full-duplex
Gateway:                194.xxx.*.x
Site router:            194.xxx.*.x
DNS server(s):          194.xxx.*.x
Default domain:         tsai.es
Inside interface:       unsecure
Outside interface:      unsecure
Look password:          ******
Touch password:         ******
Link speed:             50M
Packet shaping:         off
Traffic discovery:      off
SNMP look community:    tsai
SNMP touch community:   ******
SNMP Trap destinations: 192.168.10x.*
Modem on Console:       off
Email host:port:        none
Email sender:           none
Date, time, timezone:   Sat Nov xx 15:31:49 1999 CEST (Paris)

$$ Eso del packet shaping off me escamaba y lo de insecure interface :-?


PacketShaper> hl

  context           Show or set host list context
  resolve           Resolve DNS names in the host list
  show              Show host lists, or details of a named host list

PacketShaper> hl show

Host list entries in the current (local) context:

cn=Comercio_Alcampo 194.*.x.xx 194.*.xxx.61
cn=Comercio_BBV 194.*.x.xxx 194.*.53.x 194.*.x.xxx...
cn=Comercio_CajaMadrid 195.xxx.105.x 195.x.*.xxx
cn=DirWeb_ElPais 194.*.x.xxx 194.*.55.x 194.*.xx.x...
cn=InfoNegocio 195.xxx.*.x 195.xxx.*.x 195.xx.x.*

$$ Pues ese que una vez decia que lo de poner * y x en vez de las IP
$$ verdaderas estaba muy currado no sabe que razon tiene. }:->


PacketShaper> help partition

Partitions may be created to separate different traffic classes'
use of bandwidth.  Originally, there is a single partition associated with
each direction and the corresponding built-in traffic class, inbound and
outbound.  Each partition has a size corresponding to the corresponding link
bandwidth.  You may create additional partitions, carving that link
bandwidth into multiple, independent pieces.  The traffic classes that are
in the same partition share that partition's bandwidth; traffic classes
that are in different partitions do not share bandwidth at all.

usage: partition <arg> ...

where <arg> is one of the following:

show            Display the partitions or a particular partition


$$ Por si no lo ves claro, una particion es igual que su homonima del HD,
$$ dividir un total entre varios trozos. Tengo 50MB de salida y quiero 
$$ repartirlos de una manera x. Aqui vemos 9 particiones creadas.

PacketShaper> partition show

Link speed: inbound 50M  outbound 50M

Partition name                 Size Guarntd Excess  Usage  Cur   1 Min   Peak
                                                           rate   avg    rate
-------------------------------------------------------------------------------
Inbound                     11991000     0      0    5.7M   5.0M   4.6M  21.8M
-------------------------------------------------------------------------------
Outbound                    10494000     0      0    9.4M   7.9M   8.1M  24.1M
 Grupo_El_Pais                  1000     0      0    995k   1.0M   1.0M   9.6M
 Web_FondosWeb                  1000     0      0      0     92   4498    902k
 Web_Educalia                   1000     0      0   3432   4965   4017    334k
 Web_AEAT                       1000     0      0   12.8k  6122   2511   98.2k
 Web_TKON                       1000     0      0      0      0      0     51 
 Web_ABC                        1000     0      0      0      0      0    880 
 Web_Instituto_Cervantes        1000     0      0      0      0      0      0 


$$ Aqui vemos como hay ochos particiones de salida y que El Pais genera un
$$ trafico de narices (yo contribuyo visitando su web casi a diario)


Ahora me meti a mirar la mib (Managemente Information Database) y salian
un monton de cosas raras, era tarde y los Simpsons estaban a punto de
empezar. Hora de desconectar.



- PARTE II-. DONDE ESTARA MI PAQUETE?

Acabamos de asistir al primer acto del hackeo mas serio jamas documentado
en Espa~a. No, no me ha dado la vena de que soy 'SET membah' simplemente
que en SET se ponen por escrito cosas de las que normalmente solo nos
enteramos por la prensa...cuando hay detenciones.
Nosotros pretendemos escribir de ello desde la normalidad y reivindicando
que un hacker (todos a coro) NO es un delicuente. Eh!, y yo tampoco!!.
Dejemos aparte las seis lineas ideologicas y volvamos a la accion.

Examinemos la situacion, hay dos problemas:

1) No tenemos ni papa de que sistema es ese, aunque los comandos sean bastante
autoexplicativos y supongamos para que vale nos hace falta una referencia
mas solida si queremos investigar mas.

2) No tenemos acceso touch, solo look. (Igual me pasa con las tias).


Asi que voy a http://www.packeteer.com y mucha foto, mucha propaganda pero
para entrar a la parte de Documentacion tienes que ser usuario registrado.
Me estan fastidiando todas estas empresas que venden cosas raras y luego
no ofrecen info mas que a los que las compran, ultimamente me he tropezado
con varias. No comprenden que eso solo llevan a que tengamos que hackear
algo para conseguir lo que podrian dar gratis??.

A ver, encuentro una URL http://www.packetshaper.com (o algo asi) donde
puedes entrar poniendo el numero de serie siempre que el cajetin ese (el PS)
este registrado. Numero de serie? me suena. Bingo!. Lo muestra al ejecutar
el comando 'version'. Pruebo y me sale algo como:

Sorry, your PacketShaper serial number was not found

One of the following conditions may exist:

  * Your serial number is not registered.
  * You mistyped your serial number.

La segunda no es porque he hecho el tipico cut&paste asi que resulta que
los vagos de TSAI no han registrado su PacketShaper.
Pues no hay problemo!!.
Me planto en el PacketShaper de TSAI con mi browser, no meto clave (entro
usando una cookie) y le doy al boton de "Registration and Support". 
Me lleva a la web de Packeteer a meter mis datos personales, contesto
verazmente a todo (mentir es pecado) y me permito la licencia humoristica,
a mi entender, de poner Timofonica en el apartado de Empresa.
Listo, registrado. Con dos narices. 
Para que digan que los hackers solo hacemos que estropear cosas, ahora
aparezco en el area de documentacion de Packeteer y me bajo los siguientes
archivos:

ps4000gs.pdf     PacketShaper Getting Started Guide  (562k)
40.refguide.pdf  PacketShaper Reference Guide v 4.0  (1.9M)

Estos se unen a tres que estaban publicamente disponibles y que eran una
especie de folletos propagandisticos pero que al menos sirvieron para
hacerme una idea de que iba el invento.

http://www.packeteer.com/technology/pdf/white2.pdf
http://www.packeteer.com/techonology/pdf/foursteps.pdf
http://www.packeteer.com/technology/pdf/network.pdf


Con mas de 3MB de documentacion ya puedo empezar a enterarme de como
funciona el cajetin este (tambien me he bajado un gif para verlo :-) )
Y tu ahora querras que te lo explique en 20 lineas...hare lo que pueda.

Pero ahora, tras realizar mi buena accion del dia, otra pausa. He quedado
y ya llego tarde y eso de "No mira, es que me habia enrollado hackeando
Telefonica" creo que no cuela como excusa creible. :-(
....................
....................

Volvemos a la carga: Me leo unos cuantos archivos y ya estoy mas puesto
en el PS, voy a tratar de resumirlo. Si no te aclaras visita la web de
Packeteer y bajate por ejemplo el archivo foursteps.pdf que esta al
alcance de 'to quisqui'.

Que es un Packetshaper?

Fisicamente, una especie de maletin de unos 5 kg de peso con 2 conectores de 
red, un puerto serie y un LCD.
Logicamente, un sofisticado sistema de control de trafico con un sistema 
operativo propio. 


Y que hace?

Normalmente se instala entre tu hub y el router que da salida a Internet,
su mision es controlar todo el trafico que entra y sale pero no como un 
firewall sino con un objeto muy diferente: Dar prioridad a un trafico en
detrimento de otro, establecer minimos garantizados, desviar cierto tipo
de trafico.
Para ello el PacketShaper (PS), una vez configurado y en marcha, cuenta con
varias caracteristicas que veremos ahora.

1- Traffic Discovery, si se activa esta opcion (por defecto ON) el PS
analiza tanto el trafico OUTBOUND (que va de dentro de la red hacia fuera)
y el INBOUND (que viene de fuera a dentro de la red) creando CLASES de trafico
por defecto. Tambien puedes crear tu las clases que quieras.

2- Clases. Las clases pueden ser tan genericas o detalladas como quieras:
Por ejemplo:

/INBOUND/HTTP que pillaria todo el trafico HTTP dirigido hacia la red interna
/OUTBOUND/xxx.xxx.xxx.xxx/QUAKE-2 que englobaria el trafico externo generado
por la IP xxx.. usando el protocolo del Quake-2.
/INBOUND/Citrix_Traffic/From_Ingenieria/Excel podria ser una clase que se
aplicase a todo el trafico Citrix que entra a la red, que procede de nuestro
departamento de Ingenieria en..Malasia? y que dentro de ese trafico Citrix
SOLO se aplicaria a aquellos que van a trabajar con Excel y no a los que
van a jugar a Civilization ;-).

El nivel de detalle que permite es impresionante (en dos palabras) pudiendo
crear toda una clase de trafico para un archivo determinado.
Por ejemplo, si justo posteas el ultimo kernel de Linux y no quieres que
te colapse el servidor podrias establecer una POLITICA (policy) que
determine cuanto trafico puede generar ese archivo, en que condiciones y
que pasa si excede el trafico permitido.

Ahora tienes un monton de clases ya que el PS las genera automaticamente
analizando el trafico que ve pasar (y recuerda que al estar entre tu LAN
y el router hacia la WAN lo ve TODO), ademas no te pienses que se pierde.
El condenado lo entiende practicamente todo, mas de 150 protocolos distintos
y es incluso capaz de seguir sesiones que cambian de puertos dinamicamente
o sesiones en puertos no usuales (no pienses que por que pongas tu servidor
web particular en el puerto 514 va a dejar de darse cuenta de que ese
trafico es HTTP). Un mal bicho. Que haces con tanta clases?


3- Politicas. Aqui tenemos un PS analizando cuanto? 20Mb/s de trafico?. Mas?
El nuestro en particular tenia el shaping off, eso quiere decir que no
aplica ninguna politica al trafico, simplemente lo ve y lo deja pasar.
El shaping se cambia ejecutando:

> setup shaping <on|off|bypass>

off (por defecto) El PS ve el trafico y lo deja pasar transparentemente
on El PS aplica las politicas especificadas a cada clase de trafico que
   las tenga
bypass El PS hace como si no existiese

Para cambiarlo se necesita nivel touch que no tenemos...de momento.

Y que politicas se pueden aplicar?

Basicamente son tres

Una que garantiza un nivel minimo 
Por ejemplo:
Clase VoiceOverIP. 20kb/s guaranteed

Con menos quien puede oirse? XDD

Otra que da prioridad a un trafico sobre otro a la hora de repartirse
el ancho de banda 'sobrante'.
Por ejemplo:

Clase /INBOUND/Telnet/MiservidorSAP/desde-soporte-tecnico: Priority 6

Queremos que nos arreglen el servidor si o no? :-DD

Y la otra ya la hemos visto en el log, la particion, digamos que tengo
40MB/S de conexion

Clase /Pet-Mi-RED/ Particion 1000k

Otorga 1000k de esos 40MB a las peticiones que origine mi red, si sobra
algo se lo reparten las otras clases segun prioridad.


Mas o menos esta politica (la basica) funciona como el CIR y el EIR de una
Frame Relay, o sea:

A ti te doy esto, a ti esto otro, a ti esto poco que me queda y lo que os
sobre a cada uno mas lo que no esta asignado os lo repartis siguiendo esta
prioridades que os he puesto.

Luego hay otras politicas muy majas como Discard, Never-Admit e Ignore.

Discard, esto es como un firewall, todo ese tipo de trafico se descarta
sin dar ni los buenos dias. Por ejemplo, que nuestro compa~ero de trabajo
nos cae mal?. Pues nada, todo el trafico HTTP que vaya a su IP lo descartamos
y que curre en vez de visitar webs porno. Solo hay que dar a un boton.

Never-Admit, nos permite controlar quien entra y quien no y redirigir el
trafico. Por ejemplo si PS detecta que el servidor web se esta hundiendo
por debajo de los tiempos de respuesta establecidos como minimos (hemos
puesto las fotos de -tufantasiapreferidaaqui- desnuda) puede automaticamente
dirigir el trafico a una pagina que diga. "Lo siento, estamos colapsados"

Ignore, pues eso que pasa de todo. Que no se meta en ese trafico. 
Por ejemplo que no mangonee en el trafico SSH o HTTPS.

4- Informes. Para disfrutar eso hay que ir a la Web, genera informes
y estadisticas para parar un tren, completamente configurables en intervalos
de tiempo, datos mostrados...yo me saque un par por la impresora.
Por supuesto con graficos de tarta, colorinos....un pasote.


Un informe con el listado de todas las clases de trafico del PS objetivo
me ocupo 7 paginas, muestra el numero de conexiones, la cantidad de
trafico, el trafico garantizado y la particion (si las hay)..
No es extra~o si recuerdas que al hacer

> sys limits

Mostraba 138 clases (hasta un maximo de unas 550 aun queda)
9 particiones (ya las vimos), 2 politicas definidas...etc




- PARTE III-. PASO AL PAQUETE


De nuevo en las trincheras, esto es lo que pienso hacer ahora:

1) Otra entrada por telnet para probar unos cuantos comandos mas y que
me llene mas el articulo ;->
2) Entrar por la web que es mas mono y sacarme algunos informes mas que
quedan chachi piruli.
3) Se me olvidaba. Eso del touch. Que aunque no quiera liarla me fastidia
no tener acceso total.


pas@solsticio:~> telnet 194.*.xxx.* | tee timo-log6

Trying 194.*.xxx.*...
Connected to 194.*.xxx.*.
Escape character is '^]'.


PacketShaper (194.*.xxx.*)

Password: 
PacketShaper v4.0.4g1 1999-08-11
Copyright (c) 1996-1999 Packeteer, Inc. All rights reserved.
Packet shaping: off.

PacketShaper> rtm


  drilldown         Show worst clients and servers for a traffic class
  show              Show RTM statistics
  worst             Show classes with worst RTM values

$$ Ya es hora de que vosotros os chupeis las 138 clases. Alla vamos.

PacketShaper> rtm show

    Traffic                                    Response Time (ms)
     Class                         Goodness   Total Network Server
-------------------------------------------------------------------
Inbound                         
 Pet_Web_Telefonica_Anonimo           ---      1.5    1.5     16
 Correo_Telefonica                    ---      688    583    105
 Peticiones_ESINT70                   ---      1.6    1.5     30
 Peticiones_ESIWeb2             
  Pet_www.congreso.es                 ---      1.5    1.4     86
  Pet_www.bbv.es                      ---      1.2    1.1     69
  Peticiones_ESIWeb2_default          ---      1.3    1.2     25
 Proxy_NT_Corporativos                ---      205     17    189
 Pet_Mall_Alcampo                     ---      1.3    1.2    124
 Pet_Mall_BBV                         ---      1.4    1.0    340
 Pet_Mall_CajaMadrid                  ---      861    764     97
 Peticiones_1_millon                  ---      2.3    2.3     24
 Peticiones_El_Pais                   ---      1.5    1.5     24
 Peticiones_InfoNegocio               ---      1.0    970     62
 Peticiones_Web_Educalia              ---      1.1    1.1     24
 Peticiones_Web_FondosWeb             ---      1.4    1.4     27
 Peticiones_ESINT10                   ---      3.7    3.7     42
 Peticiones_AltaVista                 ---      3.8    3.6    173
 Peticiones_Mensatex_Int              ---      487    433     54
 Peticiones_Web_GIS                   ---      1.8    1.7     85
 Peticiones_Web_Nestle                ---      891    863     28
 Peticiones_Web_PAM                   ---      1.8    1.3    526
 Peticiones_Web_TKON                  ---      316    316      1
 Peticiones_Web_TTD                   ---      658    345    313
 Proxy_ABC                            ---      2.2    1.4    829
 News_Entrada                         ---      683    625     59
 Peticiones_ESIWeb2c            
  Peticiones_AEAT                     ---      2.2    2.2     19
  Peticiones_ESIWeb2c_default         ---      1.6    1.5     37
 Peticiones_Iberia                    ---      1.5    1.5     23
 Peticiones_Web_TSAI                  ---      939    917     23
 Peticiones_Web_Telefonica            ---      1.6    1.6     16
 Peticiones_Web_Iberonline            ---      1.4    1.3    128
 Peticiones_ESIWeb2B            
  Peticiones_Web_Mundiprensa          ---      2.3    2.3     21
  Peticiones_ESIWeb2B_default         ---      2.1    2.1     23
 Peticiones_ESIWeb2D            
  Peticiones_ESIWeb2D_default         ---      2.0    1.9     66
 Proxy_Clientes                       ---      1.1    283    859
 Peticiones_Web_INCA                  ---      2.5    2.3    212
 Proxy_Telefonica                     ---      106    100      7
 Peticiones_Servidores_ESIAMI         ---      648    463    185
 Peticiones_Double_Click              ---      830    170    660
 Peticiones_Grupo_Teleline            ---      2.2    1.8    394
 Ingenieria_Clientes                  ---      654    587     67
 Peticiones_Housing                   ---      379    199    180
 Backbone                             ---      453    395     57
 Peticiones_InfoSite                  ---      1.8    1.6    204
 Default                              ---      894    586    308
Outbound                        
 Peticiones_Proxy_Corporativos        ---      733     31    702
 Peticiones_Proxy_TSAI                ---      1.0     58    982
 AltaVista                            ---       85     57     28
 Mall_BBV                             ---       30     10     19
 Grupo_El_Pais                        ---       36     14     21
 Pet_Proxy_Clientes                   ---      928     33    895
 Pet_Proxy_NT                         ---      1.1    297    767
 Peticiones_Correo_Telefonica         ---      805    196    609
 Mensatex_Int                         ---      1.9     80    1.8
 Peticiones_Proxy_Telefonica          ---      922     42    880
 Web_1_millon                         ---       95     52     43
 Web_GIS                              ---       71     56     14
 Web_PAM                              ---      134     95     39
 Peticiones_Proxy_ABC                 ---      919    430    489
 Grupo_TeleLine                       ---      2.3    1.0    1.2
 Servidores_ESIAMI                    ---       23      5     18
 Peticiones_Ingenieria_Clientes       ---      1.0    503    539
 Housing                              ---      893    450    443
 Backbone_Salida                      ---      436    226    210
 Total_Webs_Infosite                  ---      154     97     56
 Default                              ---      383    321     62


$$ Como veis hay dos grandes divisiones OUTBOUND e INBOUND que son digamos
$$ las 'raices' del arbol de clases en PS. 
$$ Este es un caudal de datos muy sabroso que nos permite distinguir en 
$$ cada caso como esta respondiendo la red y el servidor. 
$$ Quien dijo que eso no se podia saber/hacer? :->
$$ Mencionaremos al Grupo_TeleLine como consistentemente malo tanto en
$$ trafico de entrada como en el de salida. Sufridos usuarios cautivos...


$$ Vemos aqui como aparecen por muchos sitios los nombres de Telefonica y
$$ sus secuaces, digo filiales, (Teleline, TSAI, Ole, el Congreso ...)
$$ tambien vemos a El Pais, ABC, Altavista, BBV, Iberia...
$$ Caramba, cualquiera diria que nos hemos metido de lleno en el centro
$$ del trafico de Internet en Espa~a. Hum?. Puede.


PacketShaper> help net
View network statistics

usage: net nic | ip | pna


PacketShaper> net pna
udp:
	28020 datagrams delivered to users
	3 datagrams received for unknown ports
	0 datagrams received with other errors
	27725 datagrams sent
tcp:
	15655 segments sent
	16 segments retransmitted
	0 segments sent with RST flag
	16679 segments received
	0 segments received in error
	36 failed TCP connection attempts
	2 TCP connections reset
ip:
	101961 received from interfaces
	0 drops due to format errors
	57042 drops due to invalid addresses
	0 drops due to unknown protocol
	0 discarded with no problems
	43600 supplied by IP user protocols
	0 dropped due to no routes
	0 IP datagrams forwarded



PacketShaper> traffic tree


Class name                         Type  Class   Policy  Cur  1 Min   Peak
                                          hits    hits  rate   avg    rate
---------------------------------------------------------------------------
/Inbound                           +               n/a   4.9M   4.6M   n/a 
 Proxy_Corporativos                      70652     n/a  6610   18.2k   871k
 Proxy_TSAI                              46948     n/a   678   4478    4.2M
 Pet_Web_Telefonica_Anonimo              10935     n/a     0   1669   46.6k
 Correo_Telefonica                      148363     n/a   166   3862    9.8M
 LIBRE1                                      0     n/a     0      0      0 
 Peticiones_ESINT70                     407142     n/a  12.2k  25.0k   169k
 Peticiones_ESIWeb2                                n/a  2009   18.7k   n/a 
  Pet_www.congreso.es                    17639     n/a   193    804    100k
  Pet_www.bbv.es                         32795     n/a   212   2246    119k
  Peticiones_ESIWeb2_default            197046     n/a   598   15.6k   198k
 Proxy_NT_Corporativos                   12595     n/a  3842   3887    231k
 Pet_Mall_Alcampo                        42927     n/a  5178   6205   98.3k
 Pet_Mall_BBV                            72721     n/a     0      3    117k
 Pet_Mall_CajaMadrid                     23140     n/a  2242   2131   77.1k
 Peticiones_1_millon                     23903     n/a  10.3k  18.7k   102k
 Peticiones_El_Pais                    2789176     n/a   161k   154k   1.5M
 Peticiones_Housing_Citroen                  0     n/a     0      0      0 
 Peticiones_InfoNegocio                 181839     n/a  4705   3414   81.1k
 Peticiones_Web_Educalia                 63128     n/a    38    411    149k
 Peticiones_Web_FondosWeb                11034     n/a     0    365   68.3k
 Peticiones_ESINT10                      10302     n/a     0      5   54.9k
 Peticiones_AltaVista                   586639     n/a  34.3k  37.7k   185k
 Peticiones_Housing_Ifigenia                 0     n/a     0      0      0 
 Peticiones_Mensatex_Int                  3087     n/a     0      1    111k
 Peticiones_Web_GIS                      37372     n/a   246   1756   74.6k
 Peticiones_Web_Nestle                   53107     n/a     0      1   87.8k
 Peticiones_Web_PAM                    1351396     n/a   105k   105k   357k
 Peticiones_Web_TKON                         6     n/a     0      0    104 
 Peticiones_Web_TTD                       1103     n/a     0      3   14.5k
 Proxy_ABC                              173265     n/a   183k  58.2k   468k
 News_Entrada                             3319     n/a   517k   161k   9.9M
 Peticiones_ESIWeb2c                               n/a  18.9k  16.8k   n/a 
  Peticiones_AEAT                         2812     n/a   985    377   14.4k
  Peticiones_ESIWeb2c_default           413193     n/a  16.9k  16.4k   212k
 Peticiones_Iberia                      325354     n/a  10.6k  21.6k   122k
 Peticiones_Web_TSAI                      6614     n/a   109     98   28.2k
 Peticiones_Web_Telefonica              438256     n/a  28.5k  31.6k   296k
 Peticiones_Web_Inst._Cervantes            5416     n/a   100     63    530 
 Peticiones_Housing_Tecknoland              98     n/a     0     26   1259 
 Peticiones_Housing_Atenet                   0     n/a     0      0      0 
 Peticiones_Housing_Autismo                  0     n/a     0      0      0 
 Peticiones_Web_Iberonline              411910     n/a  7316   8201    142k
 Peticiones_ESIWeb2B                               n/a     1    154    n/a 
  Peticiones_Web_Mundiprensa              3012     n/a     0      3   32.5k
  Peticiones_ESIWeb2B_default            23000     n/a     0    151    121k
 Peticiones_ESIWeb2D                               n/a     0     19    n/a 
  Peticiones_Web_NMP                         0     n/a     0      0      0 
  Peticiones_ESIWeb2D_default             6176     n/a     0     19   42.7k
 Peticiones_Web_ABC                       1251     n/a     0      3   3587 
 Proxy_Clientes                        1683648     n/a   1.1M   668k   4.7M
 Peticiones_Web_INCA                    369723     n/a  8417   14.2k   102k
 Proxy_Telefonica                       921032     n/a   328k   353k   5.3M
 Peticiones_Servidores_ESIAMI            47383     n/a   203k   195k   7.9M
 Entrada_InfoMail_InfoVia                    0     n/a     0      0      0 
 Entrada_InfoMail_Internet                   4     n/a     0      0   3635 
 Peticiones_Renault                          0     n/a     0      0      0 
 Peticiones_Double_Click                 27720     n/a     0    174   15.0k
 Peticiones_Grupo_Teleline             9473517     n/a   1.4M   1.2M   8.7M
 Ingenieria_Clientes                     12956     n/a   111    378    2.2M
 Peticiones_Housing                     191535     n/a  19.0k  28.4k   5.0M
 Accesos_Corporativos                     1778     n/a     0   6638    254k
 Backbone                              17911340     n/a   134k   159k   790k
 DeutschBank_Particulares                    0     n/a     0      0      0 
 Cable_TeleLine                              0     n/a     0      0      0 
 Peticiones_Housing_OLE                      0     n/a     0      0      0 
 Peticiones_InfoSite                   11632094     n/a   327k   994k   4.4M
 Default                            P I3567187 53848589   283k   239k   3.4M

/Outbound                          +               n/a  11.2M  11.4M   n/a 
 Peticiones_Proxy_Corporativos           66987     n/a  2981   4605    691k
 Peticiones_Proxy_TSAI                   40695     n/a   151    459    623k
 Web_Telefonica_Anonimo                  17145     n/a     0   1412    200k
 CorporativoWeb_ElPais                      15     n/a     0      0    279 
 Web_FondosWeb                     +     14798     n/a     0    502    902k
 AltaVista                              640764     n/a   301k   442k   7.1M
 LIBRE2                                      0     n/a     0      0      0 
 Mall_Alcampo                            46452     n/a  6900   13.3k   229k
 Mall_BBV                                78803     n/a     0   1653    4.5M
 Grupo_El_Pais                     +   3900075     n/a   1.4M   1.3M   9.6M
 InfoNegocio                            218101     n/a  9431   14.0k   552k
 Mall_CajaMadrid                         24459     n/a  16.5k  13.0k   514k
 Pet_Proxy_Clientes                    1733716     n/a   907k   688k   4.5M
 Pet_Proxy_NT                            16047     n/a  1953   2648    2.0M
 Peticiones_Correo_Telefonica            37453     n/a     0    782    3.7M
 Housing_Citroen                             0     n/a     0      0      0 
 Housing_Ifigenia                            0     n/a     0      0      0 
 Mensatex_Int                             2790     n/a     0      2    155k
 Peticiones_Proxy_Telefonica            894749     n/a  40.0k  40.2k   1.5M
 Web_1_millon                            36348     n/a  6130   9266    5.4M
 Web_ABC                           +      1214     n/a     0      0    880 
 Web_Educalia                      +     74719     n/a  2069   5513    334k
 Web_ESINT10                             11683     n/a     0      1    691k
 Web_ESINT70                            519228     n/a  50.7k   151k   7.3M
 Web_ESIWeb2                                       n/a  34.4k  68.7k   n/a 
  www.bbv.es                             66243     n/a  1375   9054    2.8M
  www.congreso.es                        13137     n/a  3582   11.4k   5.2M
  Web_ESIWeb2_default                   254792     n/a  12.2k  48.3k   4.1M
 Web_GIS                                 45575     n/a   921   13.6k   4.4M
 Web_Iberia                             404922     n/a  47.2k   112k   1.0M
 Web_Iberonline                         528112     n/a  30.9k  43.6k   955k
 Web_INCA                               392867     n/a  72.4k  94.3k   827k
 Web_Nestle                              63924     n/a     0    121    335k
 Web_PAM                               1384834     n/a   505k   602k   5.3M
 Web_TKON                          +         8     n/a     0      0     51 
 Housing_Tecknoland                         70     n/a     0      0     40 
 News_Salida                              6262     n/a  61.5k  20.3k   1.2M
 Web_ESIWeb2C                                      n/a   181k   205k   n/a 
  Web_AEAT                         +     12916     n/a  7406   3865   98.2k
  Web_ESIWeb2C_default                  610388     n/a  83.1k   201k   2.8M
 Web_ESIWeb2B                                      n/a   175     81    n/a 
  Web_Mundiprensa                         6127     n/a     0      1    910k
  Web_ESIWeb2B_default                   25017     n/a    87     80    1.3M
 Web_ESIWeb2D                                      n/a   255     91    n/a 
  Web_NMP                                    0     n/a     0      0      0 
  Web_ESIWeb2D_default                    8697     n/a   127     91    541k
 Web_Instituto_Cervantes           +      5407     n/a     0      0      0 
 Web_Telefonica                         579687     n/a   164k   179k   2.9M
 Web_TSAI                                 9089     n/a   402     48    253k
 Housing_Autismo                             0     n/a     0      0      0 
 Peticiones_Proxy_ABC                   183015     n/a   207k  71.3k   350k
 Web_TTD                                  3977     n/a   716     51   26.8k
 Grupo_TeleLine                        11240023     n/a   4.4M   4.2M   8.3M
 Salida_InfoMail_InfoVia                     0     n/a     0      0      0 
 Servidores_INET                            56     n/a     0      0      0 
 Servidores_ESIAMI                       81892     n/a   201k   188k  11.6M
 Servidores_ACE                              0     n/a     0      0      0 
 Servidores_TSAI                            54     n/a     0      0   2524 
 WEB_Renault                                 0     n/a     0      0      0 
 Double_Click                            28110     n/a     0    504   12.8k
 Salida_InfoMail_Internet                    4     n/a     0      0      0 
 Peticiones_Ingenieria_Clientes           14435     n/a   121    136    902k
 Housing                                146328     n/a  5996   8043    188k
 Backbone_Salida                       18102167     n/a   293k   320k  13.4M
 Housing_OLE                                 0     n/a     0      0      0 
 Pet_Cable_TeleLine                          0     n/a     0      0      0 
 Peticiones_Acceso_Masivo                    0     n/a     0      0      0 
 Total_Webs_Infosite                   11554380     n/a   597k   818k   9.5M
 Default                            P I3590212 57739062   1.4M   1.8M   9.4M


$$ Aqui vemos el trafico en MBs. Nos fijamos en mas gente como Renault,
$$ Caja Madrid, Double-Click, Teknoland, Instituto Cervantes.. ya saben 
$$ por donde van sus paquetes?.
$$ NOTA: Los simbolitos + indican las clases con su propia particion

PacketShaper> traffic bandwidth

Aggregate usage (shaping not on)
  Inbound  rate:   4.0M  peak:  20.9M
  Outbound rate:  11.3M  peak:  25.5M


$$ Parece que la cosa esta tranquila, probemos otro comando.

PacketShaper> hostdb info

IP Address        Conn   RTT    Cur   1 Min    Peak
                        to PS   rate    avg    rate
---------------------------------------------------
194.xxx.?3.5    I 18869    3    3.1M   3.0M   6.6M
194.xxx.?5.37   I 125      3    60.4k  9526    1.9M
194.xxx.?3.133  O  49      2    4175   11.7k   2.2M
194.xxx.?3.40   I 5776     3    2.4M   1.9M   9.9M
194.xxx.?2.19   I  14      1    3340   4793   10.0M
192.168.122.6   I 198    ---    1425   3332    849k
194.xxx.?5.253  I 176      1    29.4k  22.1k   1.7M
195.xxx.?1.230  I 193      7    2147   21.2k   5.9M
209.143.147.21      0    ---       0     75    225 
206.184.139.199 O   0    ---       0     40   2038 
194.xxx.?5.25   I 1009     2    200k   136k   1.1M
194.xxx.?3.173  I 191      1    387k   298k   1.2M
195.235.10.2    O   1    233       0     27   2242 
195.235.10.192  O   1    ---       0      3    342 
194.xxx.?5.219  I 595      2    216k   167k   1.2M
194.xxx.?5.24   I 865      2    180k   189k   2.8M
195.53.208.57   O   0    ---    1219    369   1431 
213.4.34.110        0    ---       0      0    658 
194.xxx.?3.7    I   4      2    6601   6080   81.4k
200.33.116.55   O   1    245       0   1274   38.5k
207.235.5.40    O   0    ---       0     20     48 
206.246.194.7       0    ---       9      9      9 
136.199.8.101   O   0    ---      11     11     11 
200.21.234.55   O   2    504    29.5k  20.6k  48.9k
213.4.37.176        0    ---       0    279   2602 
209.45.32.131   O   0    692       0      7   44.0k
193.146.83.112  O   0    231       0     17     10 
192.220.251.1       0    ---      29     29     29 
206.13.30.11    O   0    ---      17     17     17 
62.82.8.229     O   1    354       0      2    123k
62.0.153.144    O   1    1.0    1348   5064   40.2k
141.1.1.12      O   0    ---    2390    727   2454 

9998 entries

$$ La leche!!!. En vaya hora se me ocurrio ponerlo, aunque lo ves recortado
$$ esto me ha listado 9998 entradas de IPs que estan manteniendo conexion
$$ con alguna IP del interface INSIDE.
$$ Mira, ahora hago un grep de la IP de mi jefe y me entero si esta leyendo
$$ el ABC. :-DD

PacketShaper> hostdb show

IP Address       Where   Speed/Effective Slower/Faster  TCP/UDP ref
-------------------------------------------------------------------
194.xxx.?3.5     inside   1.5M/1.9M           0/0       18580/19
194.xxx.?5.37    inside   1.5M/749.0k         0/0         110/0
194.xxx.?3.133  outside   1.5M/2.4M           0/0          41/0
194.xxx.?3.40    inside      0/6.2M           0/0        5919/1
194.xxx.?2.19   outside      0/11.7M          0/0          15/0
195.235.112.96               0/4800           0/0          10/0
195.235.116.18  outside  56.0k/62439          0/0           1/0
216.121.32.211  outside   1.5M/415.7k         0/0           0/0
192.168.131.1   outside  56.0k/141.5k         0/0           9/2
192.112.36.4    outside      0/0              0/0           0/0
194.xxx.?3.120   inside  10.0M/6.7M           0/0         275/0
194.xxx.?5.14    inside  10.0M/4.8M           0/0         915/0
206.137.97.83   outside      0/0              0/0           0/0
195.235.64.30   outside  56.0k/112.4k         0/0          10/0
194.xxx.?2.12    inside  10.0M/11.4M          0/0          44/0
194.xxx.?3.142  outside      0/9.4M           0/0          32/0
196.27.22.111   outside      0/80430          0/0           1/0
194.xxx.?3.170   inside      0/7.9M           0/0         405/1
194.xxx.?3.114   inside  10.0M/7.6M           0/0          26/2
200.36.150.16   outside  28.8k/60116          0/0           3/0
195.235.25.175  outside  28.8k/27480          0/0           0/0
208.234.0.51    outside      0/0              0/0           0/0
209.207.164.207 outside      0/396.9k         0/0           1/0
194.xxx.?4.201  outside      0/0              0/0           0/0
193.144.12.130  outside   1.5M/964.2k         0/0          16/0
213.4.34.235                 0/4800           0/0           1/0
194.xxx.?3.134  outside      0/10.6M          0/0          64/0
195.235.11.66   outside  28.8k/251.9k         0/0           4/0
195.235.214.115 outside  64.0k/87360          0/0           2/0
195.235.10.219  outside  28.8k/75669          0/0           2/0
195.xx.??5.32    inside      0/2.3M           0/0          98/0
195.235.120.139 outside  56.0k/90795          0/0          20/0
195.235.39.130  outside  10.0M/3.3M           0/0           5/5
195.235.125.68  outside  56.0k/55312          0/0           1/0
195.235.123.1   outside   128k/113.5k         0/0           1/0
10.0.1.1         inside   1.5M/1.3M           0/0           1/7
212.25.130.47   outside  33.6k/62238          0/0           2/0
195.xxx.??3.17   inside      0/1.8M           0/0        4032/0
195.235.118.59  outside   4800/4602           0/0           1/0
195.235.10.214  outside  28.8k/85246          0/0           1/0
195.235.209.187              0/28800          0/0           2/0
192.168.121.1   outside   128k/269.9k         0/0           1/0
194.xxx.?5.51    inside      0/2.2M           0/0          71/0
194.xxx.?7.106  outside  64.0k/111.0k         0/0           0/0
194.xxx.?2.44    inside   1.5M/1.6M           0/0          26/0
194.196.84.2    outside   1.5M/437.1k         0/0           1/0
194.xxx.?5.243   inside      0/4.5M           0/0          51/0
194.xxx.?3.174   inside      0/6.4M           0/0         145/0
193.0.14.129    outside      0/0              0/0           0/0
195.xx.??5.11    inside  10.0M/2.9M           0/0         222/0
195.235.118.44  outside  28.8k/28303          0/0           1/0
207.46.42.17    outside  10.0M/6.1M           0/0           0/0
212.155.41.231  outside   256k/156.6k         0/0           4/0
194.xxx.?3.135  outside      0/8.3M           0/0          54/0

9980 entries

$$ No escarmiento!!. Otras 9980 entradas que me he comido. Casi que me ha
$$ dado tiempo a leer El Quijote. Tengo controlado tanto trafico que me
$$ aburro como un enano.
$$ Por cierto, quien seran los pobres que van a 4800 bps? XDDD

PacketShaper> exit


Y salgo, entro en la web, para imprimir un par de informes y mirarmelos con
calma, si quereis cotillear os informo que el Grupo_Teleline se comio casi
el 40% del trafico, despues viene el Proxy_Telefonica, el Proxy_Clientes
y en cuanto a trafico enviado Peticiones_El_Pais esta muy arriba.
Me imprimo una grafica que muestra que Correo_Telefonica ha pasado unos 
dias muy malitos con picos que rozaban su maxima carga.

Ah, lo del touch!. Casi escondido a la derecha hay un boton que pone Access
y al lado se lee "look", toco el boton para cambiar el nivel y me sale una
caja en la que me pide la clave. Tiempo de hacer valer mi experiencia.

Pruebo sucesivamente: root, amor, Dios, sexo, machoman, admin, queseyo.
[Si ves tu clave aqui hazme caso y cambiala XDDD]

NO FUNCIONA!!!!. Vaya timo, voy a devolver la pelicula Hackers. Lo malo es
que mis trucos de super-hacker se han agotado.
Huh...tiempo de ponerse a pensar.

Si no me equivoco no he vuelto a poner claves porque me ha dado una
cookie para entrar directo, vamos a ver el fichero de cookies

Tengo dos de este site, voy a poner aqui la segunda.

194.*.xxx.*	FALSE		FALSE	1514809221	PSxxV310	look

Dominio, seguro, fecha de expiracion, nombre y valor. Sera posible??.
No puede ser tan facil pero por probar....
Cierro el navegador para que escriba todas las cookies en memoria al fichero.
Copio el fichero por seguridad (cookies --> cookies.old)
Y cambio la cookie a: 

194.*.xxx.*	FALSE		FALSE	1514809221	PSxxV310	touch


Cierro el fichero, vuelvo a lanzar el navegador y me dirijo al site del PS,
ahora al lado de Access pone:   Touch

Y funciona. Es mas que un agujero, es una autopista de seis carriles!!. 
Tengo el CONTROL TOTAL del PS.

Game Over.


- PARTE IV-. ADIOS AL PAQUETE

Pues no, no hice nada de lo que media el cuerpo ni nada de que lo que
se esperaria de un 'piligroso delicuente hinfosmatico'.

Que me pedia el cuerpo?.

- Poner todo el trafico de Iberia a un _maximo_ de 1kb/s :
  Moraleja: Si va a volar con Iberia, vaya acostumbrandose a esperar.
- Crear una nueva clase de trafico en Correo_Telefonica para todos
  los mensajes a Villalonga (tendra el correo ahi digo yo) y eliminarlos
  sin avisar :-O
- Vigilar todo el trafico que genera el servidor del Congreso a ver si
  se esta haciendo buen uso de el
- Guipar todas las sesiones Telnet y FTP (da mucho juego)
- Numero 1: Aplicar un Redirect URL a la web de Telefonica.

Que se esperaria de un 'piligroso delicuente hinfosmatico'?

- Bloquear todo el trafico a El_Pais y el ABC
- Resetear el PS, desconfigurarlo, cargar una nueva imagen del
  SO troyanizada.
- Dejar a todos los usuarios de Teleline sin servicio.
- Darle un Discard a Backbone_Salida, veras tu como nos reiamos. 
- Pegar un Never Admit masivo y cargarme tanto trafico que la quejas iban
  a llegar hasta la ONU.

Lo podia haber hecho por supuesto, poner el shaping a on y crear una serie
de politicas Never-Admit, Redirect URL, hacer un Discard salvaje... 
Podia haber hecho con el PS lo que quisiera, era completamente mio.

Venci y se acabo. No era un reto contra nadie en particular y no me llevo 
grandes energias pero si me dejo satisfecho.

Siempre hemos defendido en SET la etica que dice eso de que los hackers 
entran para mirar, para explorar y no para reventar cosas o chafar servicios.
Por grande que fuese la tentacion (y lo era, me costo no pensar en ello)
hay que demostrar que eso no son palabras vacias sino que cuando se tiene
oportunidad de demostrarlo se demuestra. 
Aprendi mucho sobre el PacketShaper y algo sobre Timofonica a la que tenia
abandonada desde hace tiempo.

Puede que los defensores del comercio electronico se escandalicen, como va
a prosperar esto si los melenudos se meten en todas partes?. 
El mangante que hace un par de a~os se hacia admin en los routers de
Infovia ahora se hace admin y controla la mitad del trafico de Internet en 
Espa~a. Supongo que a eso es a lo que llamamos progreso ;->.
Tranquilos, os podia ir peor. Id al SIMO y coged folletos de propaganda.
Comprad. Asistid a conferencias de Arias Pasmado y Villalonga.


Y puede que algunos se decepcionen porque les hubiese gustado ver como
www.telefonica.es se desviaba a www.timofonica.com (por ejemplo) pero
realmente creeis que el asaltar paginas web consigue algo mas que satisfacer
nuestro ego?. Solo sirve para dar razones a los que no acusan de delicuentes
pero no quiero dar sermones a nadie. Cada palo que aguante su vela.


Timofonicos, grandes empresas y demas beautiful people de Internet:

Mirad, podeis poner firewalls, IDS y todos los inventos de ultima 
generacion que querais, entrabamos antes, seguimos entrando ahora 
y seguiremos entrando cuando queramos en el futuro.

Vosotros teneis el dinero, los servidores y el soft hiper-caro
Nosotros solo el control.

Despues de todo no os esta yendo tan mal :-)). Ahora os dejo, como
he comentado al principio yo tenia otros asuntos y no puedo seguir
perdiendo el tiempo contando los agujeros de la red Timofonica. 



- ANEXO A-. EL HACKER RESPONSABLE	

El manual del hacker politicamente correcto indica que yo deberia contactar
con:
A- Los (ir)responsables de TSAI
B- Los paquetes de Packeteer.

A TSAI, deberia informarles de mis descubrimientos y de como asegurar el PS
(esto ya en plan guay total). Un carajo. No soy ningun white hat ni nada asi,
la gente de TSAI esta leyendo esto asi que voy a suponer que son capaces de
encontrar su PS antes que el resto de lectores lo haga y que van a cerrarme
el acceso total del que llevo disfrutando un largo tiempo.
Leedse los manuales o contratad un auditor de seguridad, pero como en el fondo
soy un trozo pan buscad algo como "setup outside secure".
Deshabilitad el acceso Web.

B Packeteer, deberia informarles de lo grandioso del bug que permite saltarse
las restricciones a la torera. Un carajo. La proxima vez que no se pongan tan
tontos y pejigosos para repartir un manual de mi***a.




[...]
Ni ley ni deber me invitaron a la lucha,
ni los estadistas ni la turba clamorosa,
un solitario impulso de deleite
me trajo a este tumulto entre las nubes.
[...]

William Butler Yeats


Y recordad, hagais lo que hagais.
Tened cuidado ahi fuera.

Paseante


 


